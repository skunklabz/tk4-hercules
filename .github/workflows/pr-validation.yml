name: PR Validation

on:
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    name: Build and Test
    
    steps:
    - uses: actions/checkout@v4
    
    - name: Build Docker image
      run: |
        docker build -t tk4-hercules:pr-${{ github.event.number }} .
        
    - name: Run validation scripts
      run: |
        if [ -f "./scripts/validation/quick-validate.sh" ]; then
          ./scripts/validation/quick-validate.sh
        fi
        
        if [ -f "./scripts/validation/validate-exercises.sh" ]; then
          ./scripts/validation/validate-exercises.sh
        fi
        
    - name: Test container startup
      run: |
        # Start container in background
        docker run -d --name test-container -p 3270:3270 -p 8038:8038 tk4-hercules:pr-${{ github.event.number }}
        
        # Wait for startup
        sleep 30
        
        # Basic connectivity test
        curl -f http://localhost:8038 || echo "Web console not responding"
        
        # Cleanup
        docker stop test-container
        docker rm test-container
