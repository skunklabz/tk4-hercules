# TKX Migration Project Rules

**Version**: 1.0.0 (2025-07-31)

This project is migrating from `tk4-hercules` to `tkx-hercules` to support both TK4- and TK5- MVS systems. Follow the comprehensive documentation and migration plan.

## Core Documentation References

### Primary Documentation
- **Migration Plan**: `docs/TKX_MIGRATION_PLAN.md` - Complete 6-phase migration strategy
- **TK5- Technical Specs**: `docs/TK5_TECHNICAL_SPECS.md` - Detailed TK5- implementation requirements
- **Existing Implementation**: `docs/TK5_EXISTING_IMPLEMENTATION.md` - Analysis of patrickraths/MVS-TK5
- **Attributions**: `docs/ATTRIBUTIONS.md` - Proper credit to all contributors

### Key Migration Phases
1. **Phase 1**: Repository rename and metadata updates
2. **Phase 2**: Infrastructure setup with version directories
3. **Phase 3**: TK5- implementation with 15 DASD volumes
4. **Phase 4**: Documentation updates
5. **Phase 5**: Testing and validation
6. **Phase 6**: Release and community communication

## Multi-Version Architecture

### Version Support
- **TK4-**: Current system with 8 volume mount points
- **TK5-**: New system with 15 DASD volumes
- **Future**: Architecture supports TK6-, TK7- etc.

### Volume Strategy
- **Separate volume namespaces**: `tk4-*` vs `tk5-*` volumes
- **Complete isolation**: No shared volumes between versions
- **Docker named volumes**: Better portability than bind mounts
- **Version-specific containers**: Different container names and configurations

### Directory Structure
```
tkx-hercules/
├── versions/
│   ├── tk4/          # TK4- specific files
│   └── tk5/          # TK5- specific files
├── shared/           # Common utilities and scripts
├── docker-compose.yml # Version selector
└── Makefile          # Multi-version support
```

## Implementation Guidelines

### Version Selection
- **Default**: TK4- (maintains backward compatibility)
- **Environment variable**: `MVS_VERSION=tk5` for TK5-
- **Docker Compose**: Uses version-specific configurations

### TK5- Requirements
- **Hercules 4.60**: Hyperion Hercules SDL (upgraded from 4.4.1)
- **15 DASD volumes**: TK5RES, TK5CAT, TK5DLB, TK5001, TK5002, TSO001-003, WORK01-04, INT001, PAGE00, SPOOL0
- **Download source**: TBD from prince-webdesign.nl
- **Installation process**: Complete system with Update 4 included

### Volume Mount Points
```bash
# TK4- volumes (8)
/tk4-/conf, /tk4-/local_conf, /tk4-/local_scripts, /tk4-/prt, /tk4-/dasd, /tk4-/pch, /tk4-/jcl, /tk4-/log

# TK5- volumes (15)
/tk5-/tk5res, /tk5-/tk5cat, /tk5-/tk5dlb, /tk5-/tk5001, /tk5-/tk5002, /tk5-/tso001, /tk5-/tso002, /tk5-/tso003, /tk5-/work01, /tk5-/work02, /tk5-/work03, /tk5-/work04, /tk5-/int001, /tk5-/page00, /tk5-/spool0
```

## Attribution Requirements

### Proper Credit
- **patrickraths/MVS-TK5**: Existing Docker implementation
- **Rob Prins**: TK5- creator
- **Jürgen Winkelmann**: TK4- creator
- **Volker Bandke**: Original TK3 creator
- **Hercules Team**: Emulator development

### Documentation Updates
- Always reference `docs/ATTRIBUTIONS.md`
- Include proper links to original projects
- Acknowledge influences in README and documentation

## Migration Commands

### Repository Rename
```bash
# Rename repository
gh repo rename tkx-hercules --repo skunklabz/tkx-hercules

# Update local remote
git remote set-url origin https://github.com/skunklabz/tkx-hercules.git

# Update metadata
gh repo edit --description "Multi-version MVS mainframe emulator supporting TK4- and TK5- systems on Hercules"
gh repo edit --add-topic mainframe,mvs,hercules,tk4,tk5,emulation,education,retrocomputing
```

### Version-Specific Commands
```bash
# Build and run TK4- (default)
make build-tk4
make start-tk4

# Build and run TK5-
make build-tk5
make start-tk5

# Test both versions
make test-tk4
make test-tk5
```

## Docker Implementation

### Base Image Strategy
- **Learn from patrickraths**: Use SDL-Hercules base image approach
- **Remove embedded Hercules**: Avoid conflicts
- **Include file strategy**: For user DASD configuration
- **Proper capabilities**: `SYS_NICE` for performance

### Volume Management
- **Docker named volumes**: Better portability than bind mounts
- **Version isolation**: Separate volume namespaces
- **User DASD support**: Allow custom volume addition
- **Migration tools**: DSSDUMP/DSSREST support

## Testing and Validation

### Multi-Version Testing
- **TK4- functionality**: Ensure unchanged behavior
- **TK5- system boot**: Verify 15-volume support
- **Volume mounting**: Test all 15 TK5- volumes
- **Hercules 4.60**: Verify upgraded emulator
- **New features**: Test INTERCOMM, LUA370, SLIM, STF

### Validation Checklist
- [ ] TK4- functionality unchanged
- [ ] TK5- system boots successfully
- [ ] All 15 TK5- volumes mount correctly
- [ ] Hercules 4.60 works properly
- [ ] New TK5- features accessible
- [ ] Documentation accurate for both versions

## Release Strategy

### Version Management
- **Current**: `1.1.1-tk4` (TK4- version)
- **New**: `1.2.0-tk5` (TK5- version)
- **Tags**: `latest-tk4`, `latest-tk5`

### Communication
- **Migration guide**: Clear path from TK4- to TK5-
- **Feature comparison**: Document differences
- **Educational value**: Learning materials for both versions
- **Community awareness**: Proper attribution and collaboration

## Risk Mitigation

### Backward Compatibility
- **TK4- as default**: Maintain existing user experience
- **Gradual migration**: Users can test TK5- without losing TK4-
- **Documentation**: Clear migration path and support

### Rollback Plan
- **Immediate**: Revert repository name if critical issues
- **Short-term**: Maintain old image names alongside new ones
- **Long-term**: Provide clear migration path with support

## References

- **Migration Plan**: `docs/TKX_MIGRATION_PLAN.md`
- **TK5- Technical Specs**: `docs/TK5_TECHNICAL_SPECS.md`
- **Existing Implementation**: `docs/TK5_EXISTING_IMPLEMENTATION.md`
- **Attributions**: `docs/ATTRIBUTIONS.md`
- **patrickraths/MVS-TK5**: https://github.com/patrickraths/MVS-TK5
- **TK5- Documentation**: https://www.prince-webdesign.nl/tk5
description:
globs:
alwaysApply: false
---
